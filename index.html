<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservas - Merendero Leo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        form, .admin-section {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .reservas {
            margin-top: 20px;
        }
        .admin-section {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Reservas - Merendero Leo</h1>
    <form id="reservaForm">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre" required>

        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha" name="fecha" required>

        <label>Horarios:</label>
        <label><input type="checkbox" name="horarios" value="mañana"> Mañana</label>
        <label><input type="checkbox" name="horarios" value="tarde"> Tarde</label>
        <label><input type="checkbox" name="horarios" value="noche"> Noche</label>

        <button type="submit">Reservar</button>
    </form>

    <div class="reservas">
        <h2>Historial de Reservas</h2>
        <ul id="reservaHistorial"></ul>
    </div>

    <button id="adminBtn">Administrar Reservas</button>

    <div class="admin-section" id="adminSection">
        <h2>Eliminar Reservas</h2>
        <label for="adminPassword">Contraseña:</label>
        <input type="password" id="adminPassword">
        <button id="loginBtn">Ingresar</button>
        <ul id="adminReservas"></ul>
    </div>

    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script>
        // Inicializar EmailJS
        (function() {
            emailjs.init("YOUR_USER_ID"); // Reemplaza con tu User ID de EmailJS
        })();

        const form = document.getElementById('reservaForm');
        const historial = document.getElementById('reservaHistorial');
        const adminBtn = document.getElementById('adminBtn');
        const adminSection = document.getElementById('adminSection');
        const adminPassword = document.getElementById('adminPassword');
        const loginBtn = document.getElementById('loginBtn');
        const adminReservas = document.getElementById('adminReservas');

        // Cargar historial de reservas desde localStorage
        const reservas = JSON.parse(localStorage.getItem('reservas')) || [];

        function mostrarReservas() {
            historial.innerHTML = '';
            reservas.forEach((reserva) => {
                const li = document.createElement('li');
                li.textContent = `Nombre: ${reserva.nombre}, Fecha: ${reserva.fecha}, Horarios: ${reserva.horarios.join(', ')}`;
                historial.appendChild(li);
            });
        }

        function mostrarReservasAdmin() {
            adminReservas.innerHTML = '';
            reservas.forEach((reserva, index) => {
                const li = document.createElement('li');
                li.textContent = `Nombre: ${reserva.nombre}, Fecha: ${reserva.fecha}, Horarios: ${reserva.horarios.join(', ')}`;
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Eliminar';
                deleteBtn.style.marginLeft = '10px';
                deleteBtn.onclick = () => {
                    reservas.splice(index, 1);
                    localStorage.setItem('reservas', JSON.stringify(reservas));
                    mostrarReservas();
                    mostrarReservasAdmin();
                };
                li.appendChild(deleteBtn);
                adminReservas.appendChild(li);
            });
        }

        mostrarReservas();

        // Manejar el envío del formulario
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const nombre = document.getElementById('nombre').value;
            const fecha = document.getElementById('fecha').value;
            const horarios = Array.from(document.querySelectorAll('input[name="horarios"]:checked')).map(input => input.value);

            if (horarios.length === 0) {
                alert('Por favor, selecciona al menos un horario.');
                return;
            }

            const reserva = { nombre, fecha, horarios };
            reservas.push(reserva);

            // Guardar en localStorage
            localStorage.setItem('reservas', JSON.stringify(reservas));

            // Mostrar en el historial
            mostrarReservas();

            // Enviar email
            emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", {
                nombre: reserva.nombre,
                fecha: reserva.fecha,
                horarios: reserva.horarios.join(', '),
                email: "reservas.merendero.leo@gmail.com"
            })
            .then(() => {
                alert('Reserva enviada y almacenada correctamente.');
            })
            .catch((error) => {
                console.error('Error al enviar el email:', error);
            });

            // Limpiar formulario
            form.reset();
        });

        // Mostrar sección de administración al hacer clic en "Administrar Reservas"
        adminBtn.addEventListener('click', () => {
            adminSection.style.display = 'block';
        });

        // Verificar contraseña y mostrar reservas administrables
        loginBtn.addEventListener('click', () => {
            if (adminPassword.value === '123456789') {
                mostrarReservasAdmin();
                adminPassword.value = '';
            } else {
                alert('Contraseña incorrecta.');
            }
        });
    </script>
</body>
</html>
